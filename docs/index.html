<!DOCTYPE html PUBLIC "-//W3C//DTD XHTML 1.0 Transitional//EN" "https://www.w3.org/TR/xhtml1/DTD/xhtml1-transitional.dtd">
<html xmlns="http://www.w3.org/1999/xhtml">
<head>
<meta http-equiv="Content-Type" content="text/xhtml;charset=UTF-8"/>
<meta http-equiv="X-UA-Compatible" content="IE=11"/>
<meta name="generator" content="Doxygen 1.9.2"/>
<meta name="viewport" content="width=device-width, initial-scale=1"/>
<title>EtherCAT Control Framework: Welcome to Veysi ADIN &amp; Chunwoo Kim&#39;s ROS2 EtherCAT package.</title>
<link href="tabs.css" rel="stylesheet" type="text/css"/>
<script type="text/javascript" src="jquery.js"></script>
<script type="text/javascript" src="dynsections.js"></script>
<link href="navtree.css" rel="stylesheet" type="text/css"/>
<script type="text/javascript" src="resize.js"></script>
<script type="text/javascript" src="navtreedata.js"></script>
<script type="text/javascript" src="navtree.js"></script>
<link href="search/search.css" rel="stylesheet" type="text/css"/>
<script type="text/javascript" src="search/searchdata.js"></script>
<script type="text/javascript" src="search/search.js"></script>
<link href="doxygen.css" rel="stylesheet" type="text/css" />
<link href="doxygen-awesome.css" rel="stylesheet" type="text/css"/>
</head>
<body>
<div id="top"><!-- do not remove this div, it is closed by doxygen! -->
<div id="titlearea">
<table cellspacing="0" cellpadding="0">
 <tbody>
 <tr style="height: 56px;">
  <td id="projectlogo"><img alt="Logo" src="symbol.webp"/></td>
  <td id="projectalign" style="padding-left: 0.5em;">
   <div id="projectname">EtherCAT Control Framework<span id="projectnumber">&#160;v0.9</span>
   </div>
   <div id="projectbrief">Implementation of EtherCAT protocol using IgH EtherCAT library for robot controller.</div>
  </td>
 </tr>
 </tbody>
</table>
</div>
<!-- end header part -->
<!-- Generated by Doxygen 1.9.2 -->
<script type="text/javascript">
/* @license magnet:?xt=urn:btih:d3d9a9a6595521f9666a5e94cc830dab83b65699&amp;dn=expat.txt MIT */
var searchBox = new SearchBox("searchBox", "search",'Search','.html');
/* @license-end */
</script>
<script type="text/javascript" src="menudata.js"></script>
<script type="text/javascript" src="menu.js"></script>
<script type="text/javascript">
/* @license magnet:?xt=urn:btih:d3d9a9a6595521f9666a5e94cc830dab83b65699&amp;dn=expat.txt MIT */
$(function() {
  initMenu('',true,false,'search.php','Search');
  $(document).ready(function() { init_search(); });
});
/* @license-end */
</script>
<div id="main-nav"></div>
</div><!-- top -->
<div id="side-nav" class="ui-resizable side-nav-resizable">
  <div id="nav-tree">
    <div id="nav-tree-contents">
      <div id="nav-sync" class="sync"></div>
    </div>
  </div>
  <div id="splitbar" style="-moz-user-select:none;" 
       class="ui-resizable-handle">
  </div>
</div>
<script type="text/javascript">
/* @license magnet:?xt=urn:btih:d3d9a9a6595521f9666a5e94cc830dab83b65699&amp;dn=expat.txt MIT */
$(document).ready(function(){initNavTree('index.html',''); initResizable(); });
/* @license-end */
</script>
<div id="doc-content">
<!-- window showing the filter options -->
<div id="MSearchSelectWindow"
     onmouseover="return searchBox.OnSearchSelectShow()"
     onmouseout="return searchBox.OnSearchSelectHide()"
     onkeydown="return searchBox.OnSearchSelectKey(event)">
</div>

<!-- iframe showing the search results (closed by default) -->
<div id="MSearchResultsWindow">
<iframe src="javascript:void(0)" frameborder="0" 
        name="MSearchResults" id="MSearchResults">
</iframe>
</div>

<div><div class="header">
  <div class="headertitle"><div class="title">Welcome to Veysi ADIN &amp; Chunwoo Kim's ROS2 EtherCAT package. </div></div>
</div><!--header-->
<div class="contents">
<div class="textblock"><p ><a class="anchor" id="md_README"></a> This repository contains ROS2 and EtherCAT based control framework for medical robots, but this implementation can be used with any robotic system with some modifications.Contains EtherCAT real-time thread with priority of 98. Software consists of four components (ROS2 nodes) :</p>
<p >• EtherCAT node: Responsible for EtherCAT communication between master and slaves and publishes acquired feedback from slaves under /slave_feedback topic name in 1 kHz frequency. Additionally, subscribes to /master_commands topic, published from the control node, /gui_data topic published from the <a class="el" href="namespaceGUI.html">GUI</a> node, and /safety_info topic published from the safety node. Sends control commands to slaves via EtherCAT communication using control node parameters.</p>
<p >• Control node: Kinematic calculations will be done in this node. This node subscribes /slave_feedback topic published from the EtherCAT node and publishes control commands under the /master_commands topic. Currently this node retrieves button and joystick data from Xbox <a class="el" href="classController.html" title="Opens, reads from and publishes joystick events.">Controller</a> via USB communication.</p>
<p >• <a class="el" href="namespaceGUI.html">GUI</a> node: Consists of camera viewer and slave feedback visualizers such as motor state, communication state, and emergency button state. Publishes under /gui_buttons data consists of soft button events, subscribes to /master_ commands, and /slave_feedback, and /safety info topics to give visual feedback to the user. Current version of the <a class="el" href="namespaceGUI.html">GUI</a> node shown in Figure 25. Control user interface buttons activated based on lifecycle node state.</p>
<p >• Safety node: Subscribes to all published topics and checks the consistency in the system, decides about the state of the system. System-related safety information is checked every cycle. Manages lifecycle node and state transitions are triggered from this node. Published and subscribed topics for each node are shown in Table 3, and the details structure of the topics is shown in Table 4. Note that published topic messages can be changed by changing msg file contents in case custom message is required.</p>
<p >Please check guides, links and documentations before installation, or using this control framework.</p>
<h1><a class="anchor" id="autotoc_md1"></a>
Guides</h1>
<ul>
<li><a href="https://docs.ros.org/en/foxy/index.html">ROS2</a></li>
<li><a href="https://design.ros2.org/articles/node_lifecycle.html">ROS2 Life-cycle Node</a></li>
<li><a href="https://design.ros2.org/articles/ros_on_dds.html">ROS2 DDS</a></li>
<li><a href="https://design.ros2.org/articles/qos_deadline_liveliness_lifespan.html">ROS2 QoS</a></li>
<li><a href="https://www.ethercat.org/en/technology.html">EtherCAT</a></li>
<li><a href="https://www.etherlab.org/en/ethercat/index.php">Etherlab Webpage</a></li>
<li><a href="https://www.etherlab.org/download/ethercat/ethercat-1.5.2.pdf">IgH EtherCAT Library Documentation</a></li>
<li><a href="https://wiki.linuxfoundation.org/realtime/documentation/technical_basics/start">Real-time Linux</a></li>
<li><a href="https://design.ros2.org/articles/realtime_background.html">ROS2 Real-time Background</a></li>
<li><a href="https://www.ripublication.com/ijaer17/ijaerv12n21_94.pdf">Article on EtherCAT-RT PREEMPT- Xenomai</a></li>
</ul>
<h1><a class="anchor" id="autotoc_md2"></a>
Prerequisites</h1>
<ul>
<li><a href="https://github.com/veysiadn/IgHEtherCATImplementation">RT_Preempt Linux and IgH EtherCAT Implementation</a></li>
<li>If you want to use <a href="https://github.com/veysiadn/xenomai-install">Xenomai-Instalattion</a></li>
<li><a href="https://docs.ros.org/en/foxy/Installation/Ubuntu-Install-Debians.html">ROS2 Foxy Installation</a></li>
<li><a href="https://github.com/ROBOTIS-GIT/DynamixelSDK">Dynamixel-SDK</a></li>
</ul>
<h1><a class="anchor" id="autotoc_md3"></a>
Implementation</h1>
<div class="fragment"><div class="line">git clone https://github.com/veysiadn/spinerobot_ws </div>
<div class="line">cd spinerobot_ws </div>
<div class="line">git checkout development</div>
<div class="line">sudo -s</div>
<div class="line">source /opt/ros/foxy/setup.bash</div>
<div class="line">colcon build --symlink install</div>
<div class="line">. install/setup.bash</div>
<div class="line">ros2 launch ./src/ethercat_nodes_launch.py</div>
</div><!-- fragment --><h1><a class="anchor" id="autotoc_md4"></a>
Getting Started</h1>
<h2><a class="anchor" id="autotoc_md5"></a>
STEP 1 :</h2>
<p >You should start your customization from <a class="el" href="ecat__globals_8hpp.html">ecat_globals.hpp</a> file. In that file you can specify :</p><ul>
<li>Number of connected slaves and servo drives,</li>
<li>Control operation mode : Velocity Mode, Position Mode, Torque Mode, Cyclic Synchronous Velocity,Position and Torque modes are supported.</li>
<li>Control Frequency</li>
<li>Enable/Disable Distributed Clock</li>
<li>Motors encoder resolution : note that if you are using different type of motors you might need to create different definitions for each motor.</li>
<li>Motor Gear Ratio : note that if you are using different type of motors you might need to create different definitions for each motor.</li>
<li>Custom Slave : If you have different slave than the CiA402 supported servo drive you will need to define custom slave and PDO mapping for that custom slave.</li>
<li>Keep in mind that this software addresses connected slaves based on physical position with respect to the master. For example the 0th slave will be the first slave that is connected to your Ethernet port.</li>
<li>If you have a custom slave, it must be in the end of slave chain.</li>
<li></li>
</ul>
<h2><a class="anchor" id="autotoc_md6"></a>
STEP 2 :</h2>
<p >Once you did your initial configuration in the <a class="el" href="ecat__globals_8hpp.html">ecat_globals.hpp</a> file. You can modify user input method in main.cpp file.</p><ul>
<li>Currently this software uses XboxController buttons and joystick data to send control commands to the connected motors, if you want to use different input you can remove Xbox related control parameters and add your own.</li>
<li>If you want to use Xbox <a class="el" href="classController.html" title="Opens, reads from and publishes joystick events.">Controller</a> for testing, keep in mind that each axis in the controller generates analog data in the range of -32768 ~ 32768.</li>
</ul>
<h2><a class="anchor" id="autotoc_md7"></a>
STEP 3 :</h2>
<ul>
<li>Change configuration parameters for your motor in <a href="https://veysiadn.github.io/ecat_userspace/classEthercatLifeCycleNode_1_1EthercatLifeCycle.html#a620253b4fe34f13f06a60f1fb12a81cc">SetConfigurationParameters()</a> function in <a class="el" href="ecat__lifecycle_8cpp.html">ecat_lifecycle.cpp</a> file, based on your operation mode. You can check example page for detailed instructions on custom modifications, in Examples tab.</li>
<li>Change control parameters based on your selected operation mode in <a class="el" href="ecat__lifecycle_8cpp.html">ecat_lifecycle.cpp</a> file in the Update functions. For example if you want to use velocity mode in your control loop, you can change function content of UpdateVelocityModeParameters();</li>
</ul>
<p >Once you did those changes you will need recompile the software using make and you can test the executable.</p>
<h2><a class="anchor" id="autotoc_md8"></a>
NOTE</h2>
<ul>
<li>This software heavily tested on Maxon EPOS drivers, therefore if you want to use different servo driver you will need to check PDO mapping of your slave, or you can do custom PDO mapping by using MapCustomPdo function defined in <a class="el" href="ecat__node_8cpp.html">ecat_node.cpp</a> file.</li>
</ul>
<h1><a class="anchor" id="autotoc_md9"></a>
Good Luck ⚡</h1>
</div></div><!-- PageDoc -->
</div><!-- contents -->
</div><!-- doc-content -->
<!-- start footer part -->
<div id="nav-path" class="navpath"><!-- id is needed for treeview function! -->
  <ul>
    <li class="footer">Generated by <a href="https://www.doxygen.org/index.html"><img class="footer" src="doxygen.svg" width="104" height="31" alt="doxygen"/></a> 1.9.2 </li>
  </ul>
</div>
</body>
</html>
